Выпускаем сертификаты на контроллере DC

Выгружаем сертификаты 1pam и 2pam, также приватные ключи для них + Корневой сертификат

Делаем pfx (для двух):
openssl pkcs12 -export -out 1pam.newbolnica.lab.pfx -inkey 1pam.newbolnica.lab.pem -in 1pam.newbolnica.lab.crt -certfile root-ca.crt

Затем переносим полученные сертификаты на Сервер Управления, Корневой переносим в папку с дистрибутивом ПАМа.

Важно, когда в wizard выбирать Корневой сертификат - выбирать именно из папки с дистрибутивом ПАМом.


Дополнительно ставим на оба сервера - postgresql14 (репу берем с доки Редчека), docker.io, docker-compose, python3

Выставляем пароль пользователю postgres и создаем нужные БД (все в доке написано)

Заходим в файл /etc/postgresql/14/main/....(не помню, есть что-то или нет)/pg_hba.conf
в нем на месте 127.0.0.1/32 ставим 0.0.0.0/0
Далее в файле postgresql.conf - нажимаем Ctrl+W и ищем listening adre... = вместо localhost ставим "*"

sudo systemctl restart postgresql

проверка - ss -tuln | grep 5432 (если там нет 127.0.0.1, а прописаны нули - значит все ок.

На начальном экране установки в wizard - надо Добавить 2 хоста - один с ролью Управления, второй с ролью Доступа ССШ и РДП - прописать их fqdn

Далее подложить все сертификаты

Правильный Distung..d name - uid=___,cn=users,cn=accounts,dc=alddemo,dc=lab

Отлючаем второй фактор

Подгружаем пользователей из домена

Запускаем установку

Если есть ошибка - то открываем sudo docker ps -a - ищем контейнер, который Exited ли unhealthy - открываем sudo docker logs IDконтейнера и ищем ошибку, либо кормим ГПТ


Далее после успешной установки - открываем Консоль управления - заходим пользователем, которого выбирали Админом, заходим в Роли - далее Администраторы - выбираем нашего ПОльзователя - теперь он главный админ и у него много доступов

Спускаемся ниже и находим в Конфигурациях - Лицензирование - копируем ID и передаем его Кардапольцеву с указанием количества пользаков, количества Ресурсов

Добавляем домен, добавляем сервисную уз, прописываем имя без @alddemo.lab, далее он выдаст ошибку, заходим в пользователя и прописываем верный Distinguished name. 

